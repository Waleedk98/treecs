{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
{% endblock %}

{% block content %}
  <h2>Gespeicherte Baumdaten</h2>

  <!-- Filters -->
  <div class="filter-container">
    <select id="treeTypeFilter">
      <option value="">Baumart wählen</option>
      <option value="Eiche">Eiche</option>
      <option value="Kiefer">Kiefer</option>
      <option value="Buche">Buche</option>
      <option value="Ahorn">Ahorn</option>
      <option value="Birke">Birke</option>
      <option value="Fichte">Fichte</option>
      <option value="Linde">Linde</option>
      <option value="Esche">Esche</option>
      <option value="Tanne">Tanne</option>
      <option value="Douglasie">Douglasie</option>
      <option value="Pappel">Pappel</option>
      <option value="Ulme">Ulme</option>
      <option value="Zeder">Zeder</option>
      <option value="Walnussbaum">Walnussbaum</option>
      <option value="Kastanie">Kastanie</option>
      <option value="Mango">Mango</option>
      <option value="Teak">Teak</option>
      <option value="Mahagoni">Mahagoni</option>
      <option value="Palme">Palme</option>
      <option value="Olivenbaum">Olivenbaum</option>
      <option value="Zypresse">Zypresse</option>
      <option value="Eukalyptus">Eukalyptus</option>
      <option value="Akazie">Akazie</option>
      <option value="Roter Ahorn">Roter Ahorn</option>
      <option value="Balsambaum">Balsambaum</option>
      <option value="Kirschbaum">Kirschbaum</option>
      <option value="Apfelbaum">Apfelbaum</option>
      <option value="Pfefferbaum">Pfefferbaum</option>
      <option value="Zitronenbaum">Zitronenbaum</option>
      <option value="Kokospalme">Kokospalme</option>
      <option value="Bambus">Bambus</option>
      <!-- Add other tree types dynamically -->
    </select>
    <input type="number" id="minHeightFilter" placeholder="Min. Höhe (m)" />
    <input type="number" id="maxHeightFilter" placeholder="Max. Höhe (m)" />
    <button onclick="applyFilters()">Filtern</button>
    <button onclick="resetFilters()">Zurücksetzen</button>
  </div>

  <!-- Cards -->
  <div class="card-container" id="cardContainer">
    {% for tree in trees %}
      <div class="card">
        <!-- Card Title -->
        <h3>{{ tree.tree_type.name }}</h3>

        <!-- Tree Details -->
        <p>
          <strong>Höhe:</strong> {{ tree.tree_height }} m
        </p>
        <p>
          <strong>Neigung:</strong> {{ tree.inclination }}°
        </p>
        <p>
          <strong>Durchmesser:</strong> {{ tree.trunk_diameter }} cm
        </p>
        <p class="location">
          <strong>Standort:</strong> {{ tree.address }}
        </p>
        <p>
          <strong>Koordinaten:</strong> {{ tree.latitude }}, {{ tree.longitude }}
        </p>
        <p class="timestamp">
          <strong>Erfasst am:</strong> {{ tree.timestamp.strftime('%d.%m.%Y %H:%M') }}
        </p>

        <!-- Tree Photos -->
        {% if tree.photos %}
          <div class="photo-gallery">
            {% for photo in tree.photos %}
              <img src="{{ photo.photo_path }}" alt="Tree Photo" class="tree-photo" />
            {% endfor %}
          </div>
        {% else %}
          <p class="no-photos">Keine Fotos verfügbar</p>
        {% endif %}

        <!-- Card Actions -->
        <div class="card-actions">
          <button onclick="viewDetails({{ tree.id }})">Details</button>
          <button onclick="location.href='/analysis/{{ tree.id }}'">Analyse anzeigen</button>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}

{% block extra_js %}
  <script>
    function applyFilters() {
      const treeType = document.getElementById('treeTypeFilter').value
      const minHeight = document.getElementById('minHeightFilter').value
      const maxHeight = document.getElementById('maxHeightFilter').value
    
      const cards = document.querySelectorAll('.card')
      cards.forEach((card) => {
        const treeTypeText = card.querySelector('h3').textContent.trim()
        const height = parseFloat(card.querySelector('p:nth-of-type(2)').textContent.replace('Höhe:', '').replace('m', '').trim())
    
        if ((treeType && treeType !== treeTypeText) || (minHeight && height < parseFloat(minHeight)) || (maxHeight && height > parseFloat(maxHeight))) {
          card.style.display = 'none'
        } else {
          card.style.display = 'block'
        }
      })
    }
    
    function resetFilters() {
      document.getElementById('treeTypeFilter').value = ''
      document.getElementById('minHeightFilter').value = ''
      document.getElementById('maxHeightFilter').value = ''
    
      const cards = document.querySelectorAll('.card')
      cards.forEach((card) => {
        card.style.display = 'block'
      })
    }
    
    function viewDetails(treeId) {
      alert(`Details anzeigen für Baum ID: ${treeId}`)
    }
  </script>
{% endblock %}
